<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>GitHub 绑定</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div id="loading">处理 GitHub 绑定中...</div>
    </div>
    <script>
        // 从 URL 获取授权码
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        
        if (code) {
            // 使用 GitHub API 获取用户信息
            fetch(`https://api.github.com/user`, {
                headers: {
                    'Authorization': `Bearer ${code}`,
                    'Accept': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const currentUser = localStorage.getItem('currentUser');
                const userData = JSON.parse(localStorage.getItem(currentUser));
                
                // 保存 GitHub 用户信息
                userData.githubId = data.id;
                userData.githubUsername = data.login;
                localStorage.setItem(currentUser, JSON.stringify(userData));
                
                // 关闭窗口并刷新父窗口
                window.opener.location.reload();
                window.close();
            })
            .catch(error => {
                alert('GitHub 绑定失败，请重试');
                window.close();
            });
        } else {
            alert('授权失败，请重试');
            window.close();
        }
    </script>
</body>
</html> 