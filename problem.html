<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>题目详情</title>
    <link rel="stylesheet" href="styles.css">
    <script src="problem.js"></script>
    <script src="auth.js"></script>
</head>
<body>
    <div class="container">
        <h1>题目详情</h1>
        <div id="problemDetails">
            <!-- 题目详情内容 -->
        </div>
        <button id="markDoneButton" onclick="markAsDone()">做完了！</button>
        <p id="timerMessage" style="display:none;">请等待10分钟后再尝试。</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const problemId = new URLSearchParams(window.location.search).get('id');
            const problem = problems.find(p => p.id == problemId);

            if (problem) {
                document.getElementById('problemDetails').innerHTML = `
                    <h2>${problem.title}</h2>
                    <p>${problem.description}</p>
                    <small><strong>难度:</strong> ${problem.difficulty}</small><br>
                    <small><strong>标签:</strong> ${problem.tags.join(', ')}</small><br>
                    <small><strong>输入格式:</strong> ${problem.input}</small><br>
                    <small><strong>输出格式:</strong> ${problem.output}</small><br>
                    <small><strong>样例输入:</strong> <pre>${problem.sample_input}</pre></small><br>
                    <small><strong>样例输出:</strong> <pre>${problem.sample_output}</pre></small><br>
                `;
            } else {
                document.getElementById('problemDetails').innerHTML = '<p>题目未找到。</p>';
                document.getElementById('markDoneButton').style.display = 'none';
            }
        });

        function markAsDone() {
            const username = localStorage.getItem('currentUser');
            if (!username) {
                alert('请先登录！');
                return;
            }

            const lastClickTime = localStorage.getItem(`lastClickTime_${username}`);
            const currentTime = new Date().getTime();
            const tenMinutes = 10 * 60 * 1000;

            if (lastClickTime && (currentTime - lastClickTime < tenMinutes)) {
                document.getElementById('timerMessage').style.display = 'block';
                return;
            }

            const userData = JSON.parse(localStorage.getItem(username));
            if (!userData.completedProblems) {
                userData.completedProblems = [];
            }

            const problemId = new URLSearchParams(window.location.search).get('id');
            if (!userData.completedProblems.includes(problemId)) {
                userData.completedProblems.push(problemId);
                localStorage.setItem(username, JSON.stringify(userData));
                alert('题目已标记为完成！');
            } else {
                alert('您已经完成了这个题目！');
            }

            localStorage.setItem(`lastClickTime_${username}`, currentTime);
            document.getElementById('timerMessage').style.display = 'none';
        }
    </script>
</body>
</html> 