<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>题库</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="problems.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3NGJXEGSPL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-3NGJXEGSPL');
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="userlist.html" class="mail-icon">
                <i class="fas fa-envelope"></i>
            </a>
        </div>
        <h1>题库</h1>
        <div id="auth">
            <button onclick="showLogin()">登录</button>
            <button onclick="showRegister()">注册</button>
        </div>
        <div id="loginForm" style="display:none;">
            <h3>登录</h3>
            <input type="text" id="loginUsername" placeholder="用户名">
            <input type="password" id="loginPassword" placeholder="密码">
            <button onclick="login()">登录</button>
        </div>
        <div id="registerForm" style="display:none;">
            <h3>注册</h3>
            <input type="text" id="registerUsername" placeholder="用户名">
            <input type="password" id="registerPassword" placeholder="密码">
            <input type="file" id="registerAvatar" accept="image/*">
            <button onclick="register()">注册</button>
        </div>
        <div id="avatarContainer" class="avatar-container"></div>
        <input type="text" id="searchInput" placeholder="输入题号或名称搜索">
        <select id="categorySelect">
            <option value="">所有分类</option>
            <option value="算法">算法</option>
            <option value="数据结构">数据结构</option>
            <option value="数学">数学</option>
        </select>
        <select id="difficultySelect">
            <option value="">所有难度</option>
            <option value="简单">简单</option>
            <option value="中等">中等</option>
            <option value="困难">困难</option>
        </select>
        <button onclick="searchProblem()">搜索</button>
        <div id="problems"></div>
        <div id="pagination"></div>
        <div class="footer">
            <a href="about.html" class="about-button">关于我们</a>
            <a href="leaderboard.html" class="about-button">排行榜</a>
            <a href="https://github.com/Eternity-Sky/OI" target="_blank" class="github-link">
                <i class="fab fa-github"></i> GitHub
            </a>
        </div>
        <div id="loading" style="display: none;">加载中...</div>
        <div id="userCenter" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeUserCenter()">&times;</span>
                <h3>用户中心</h3>
                <p>用户名: <span id="userCenterUsername"></span></p>
                <p id="completedCount">已完成题目数: 0</p>
                <h4>修改密码</h4>
                <input type="password" id="newPassword" placeholder="新密码">
                <button onclick="changePassword()">修改密码</button>
            </div>
        </div>
    </div>

    <script>
        const problemsDiv = document.getElementById('problems');
        const paginationDiv = document.getElementById('pagination');
        const itemsPerPage = 5;
        let currentPage = 1;

        function displayProblems(problems, page = 1) {
            problemsDiv.innerHTML = '';
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedProblems = problems.slice(start, end);

            paginatedProblems.forEach(problem => {
                const problemDiv = document.createElement('div');
                problemDiv.className = 'problem';
                problemDiv.innerHTML = `
                    <h5>${problem.id}: ${problem.title}</h5>
                    <small class="difficulty-${problem.difficulty.toLowerCase()}">难度: ${problem.difficulty}</small>
                    <button onclick="viewDetails(${problem.id})">查看详情</button>
                `;
                problemsDiv.appendChild(problemDiv);
            });

            displayPagination(problems.length, page);
        }

        function displayPagination(totalItems, currentPage) {
            paginationDiv.innerHTML = '';
            const totalPages = Math.ceil(totalItems / itemsPerPage);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.className = i === currentPage ? 'active' : '';
                pageButton.onclick = () => {
                    displayProblems(problems, i);
                };
                paginationDiv.appendChild(pageButton);
            }
        }

        function searchProblem() {
            const searchValue = document.getElementById('searchInput').value.trim().toLowerCase();
            const categoryValue = document.getElementById('categorySelect').value;
            const difficultyValue = document.getElementById('difficultySelect').value;

            const filteredProblems = problems.filter(problem => 
                (problem.id.toString() === searchValue || 
                problem.title.toLowerCase().includes(searchValue) ||
                problem.tags.some(tag => tag.toLowerCase().includes(searchValue))) &&
                (categoryValue === '' || problem.category === categoryValue) &&
                (difficultyValue === '' || problem.difficulty === difficultyValue)
            );

            if (filteredProblems.length > 0) {
                displayProblems(filteredProblems);
            } else {
                problemsDiv.innerHTML = '<p>未找到匹配的题目。</p>';
                paginationDiv.innerHTML = '';
            }
        }

        function viewDetails(id) {
            window.location.href = `problem.html?id=${id}`;
        }

        function displayProblemSets() {
            const problemSetsDiv = document.getElementById('problemSets');
            problemSetsDiv.innerHTML = '';

            for (const [setName, setInfo] of Object.entries(problemSets)) {
                const setDiv = document.createElement('div');
                setDiv.className = 'problem-set';
                setDiv.innerHTML = `
                    <h3>${setName}</h3>
                    <p>${setInfo.description}</p>
                    <ul>
                        ${setInfo.problems.map(id => `<li>题目 ${id}</li>`).join('')}
                    </ul>
                `;
                problemSetsDiv.appendChild(setDiv);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            displayProblems(problems);
            displayProblemSets(); 
        });
    </script>
    <script src="auth.js"></script>
</body>
</html>